<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบทดสอบบุคลิกภาพ - Colossal International Co., Ltd.</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chart.js for beautiful charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- EmailJS SDK -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8f9fa;
            color: #212529;
            min-height: 100vh;
        }
        .theme-color { color: #00827f; }
        .theme-bg { background-color: #00827f !important; }
        .theme-border-left { border-left: 5px solid #00827f; }
        .btn-theme {
            background-color: #00827f;
            border-color: #00827f;
            color: #fff;
            transition: all 0.3s ease;
        }
        .btn-theme:hover, .btn-theme:focus {
            background-color: #006a67;
            border-color: #006a67;
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 130, 127, 0.25);
        }
        .card {
            border: none;
            border-radius: 12px;
        }
        .card-header {
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        .main-center {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .main-center > .container {
            max-width: 800px;
        }
        .answer-buttons .btn {
            border: 2px solid #00827f !important;
            background: #fff !important;
            color: #222 !important;
            box-shadow: 0 2px 8px rgba(0, 130, 127, 0.08);
            transition: all 0.2s ease-in-out;
            font-size: 1.05em;
            font-weight: 500;
        }
        .answer-buttons .btn:hover, .answer-buttons .btn:focus {
            background: #e6f2f2 !important;
            color: #005654 !important;
            border-color: #006a67 !important;
            transform: scale(1.02);
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-radius: 50%;
            border-top: 8px solid #00827f;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container-fluid main-center">
        <div class="container my-3">
            <div id="main-container">
                <!-- Start Screen -->
                <div id="start-screen" class="card shadow-sm">
                    <div class="card-header theme-bg text-white text-center">
                        <h1 class="h4 mb-0 py-2">แบบทดสอบบุคลิกภาพ</h1>
                        <p class="mb-0 small">Colossal International Co., Ltd.</p>
                    </div>
                    <div class="card-body p-4">
                        <h2 class="h5">ยินดีต้อนรับ</h2>
                        <p class="text-muted">กรุณากรอกชื่อ-สกุล หรืออีเมลของคุณเพื่อเริ่มทำแบบทดสอบ</p>
                        <input type="text" id="applicant-identifier" class="form-control mb-3" placeholder="ชื่อ-สกุล หรือ อีเมล" required>
                        <div class="d-flex align-items-start bg-light border rounded p-3 mb-3">
                            <svg class="me-3 mt-1 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                            <div>
                                <strong class="d-block">นโยบายความเป็นส่วนตัว</strong>
                                <small class="text-muted">แบบทดสอบนี้มีความปลอดภัย ข้อมูลของท่านจะถูกเก็บเป็นความลับและส่งตรงถึงฝ่ายบุคคลเพื่อใช้ในกระบวนการพิจารณาเท่านั้น</small>
                            </div>
                        </div>
                        <button class="btn btn-theme w-100 py-2" onclick="startQuiz()">เริ่มทำแบบทดสอบ</button>
                    </div>
                </div>

                <!-- Quiz Section -->
                <div id="quiz-section" class="card shadow-sm" style="display: none;">
                    <div class="card-header theme-bg text-white text-center">
                        <h1 class="h4 mb-0 py-2">แบบทดสอบบุคลิกภาพ</h1>
                    </div>
                    <div class="card-body p-4">
                        <div class="progress mb-4" style="height: 8px;">
                            <div class="progress-bar theme-bg" id="progress-bar" style="width: 0%;"></div>
                        </div>
                        <div id="question-area">
                            <div id="question-text" class="fs-5 fw-bold mb-4 text-center"></div>
                            <div class="answer-buttons d-grid gap-3" id="answer-buttons"></div>
                        </div>
                    </div>
                </div>

                <!-- Result Section -->
                <div id="result-container" class="card shadow-sm" style="display: none;">
                    <div class="card-body p-sm-5 p-4">
                        <div id="loading-results" class="text-center py-5">
                            <div class="loader mx-auto"></div>
                            <p class="mt-3 text-muted">กำลังประมวลผลและสร้างกราฟผลลัพธ์...</p>
                        </div>
                        <div id="results-content" style="display: none;">
                            <div class="text-center mb-4">
                                <h2 class="theme-color mb-1">ทำแบบทดสอบเสร็จสิ้น!</h2>
                                <p class="text-muted">นี่คือผลการประเมินเบื้องต้นของคุณ:</p>
                            </div>
                            
                            <div id="result-summary" class="text-center bg-light p-3 rounded mb-4"></div>

                            <h4 class="mb-3 text-center">กราฟแสดงผลคะแนน</h4>
                            <div id="chart-container" class="mb-4"></div>

                            <div id="result-details" class="mt-4"></div>

                            <div class="submission-section theme-border-left bg-light p-3 rounded mt-5">
                                <h3 class="h6">ขั้นตอนสุดท้าย: ส่งผลการทดสอบ</h3>
                                <p class="small text-muted mb-3">กรุณากรอกอีเมลของท่าน (สำหรับใช้อ้างอิง) และกดส่งเพื่อให้ข้อมูลถึงฝ่ายบุคคลโดยอัตโนมัติ</p>
                                
                                <form id="email-form">
                                    <div class="mb-2">
                                        <label for="sender-email" class="form-label">อีเมลของคุณ:</label>
                                        <input type="email" class="form-control" id="sender-email" placeholder="youremail@example.com" required>
                                        <div id="email-error" class="text-danger small mt-1"></div>
                                    </div>
                                    <button type="submit" class="btn btn-theme w-100">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-fill me-2" viewBox="0 0 16 16"><path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/></svg>
                                        ยืนยันและส่งผลการทดสอบ
                                    </button>
                                </form>
                                <div id="sending-status" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
    // --- CONFIGURATION ---
    const hrEmail = "jirayu.assawajindakun@gmail.com";
    const questions = [ /* ... All questions remain the same ... */ 
        { question: "โดยทั่วไปแล้ว คนอื่นมองว่าคุณเป็นคนที่...", answers: [{ text: "เข้าถึงง่ายและทำความรู้จักได้รวดเร็ว", type: "E" }, { text: "ต้องใช้เวลาในการทำความรู้จักตัวตนที่แท้จริง", type: "I" }] },
        { question: "เมื่อต้องทำงานให้เสร็จตามกำหนด คุณมักจะ...", answers: [{ text: "วางแผนและเริ่มทำแต่เนิ่นๆ เพื่อให้เสร็จทันเวลา", type: "J" }, { text: "ทำงานได้ดีที่สุดเมื่อใกล้ถึงกำหนดส่ง และมักจะเร่งทำในช่วงท้าย", type: "P" }] },
        { question: "ในการพูดคุยกับคนทั่วไป คุณเป็นคน...", answers: [{ text: "สามารถเริ่มต้นบทสนทนากับใครก็ได้", type: "E" }, { text: "จะคุยเก่งเป็นพิเศษกับคนที่สนิทหรือในสถานการณ์ที่คุ้นเคยเท่านั้น", type: "I" }] },
        { question: "หากคุณเป็นผู้ระดมทุน คุณจะเลือกสร้างบรรยากาศแบบใด", answers: [{ text: "เป็นกันเองเหมือนเพื่อน", type: "E" }, { text: "เป็นทางการ คล้ายการคุยธุรกิจ", type: "I" }] },
        { question: "คุณอยากให้คนอื่นมองว่าคุณเป็น...", answers: [{ text: "คนที่เน้นการปฏิบัติและอยู่กับความจริง", type: "S" }, { text: "คนที่มีความคิดสร้างสรรค์และเต็มไปด้วยไอเดียใหม่ๆ", type: "N" }] },
        { question: "โดยปกติแล้ว คุณเป็นคน...", answers: [{ text: "เปิดเผย เข้ากับคนง่าย", type: "E" }, { text: "ค่อนข้างเงียบและเก็บตัว", type: "I" }] },
        { question: "เมื่อมีเหตุการณ์ไม่คาดฝันเข้ามาแทรกแผนที่วางไว้ คุณจะ...", answers: [{ text: "รู้สึกขัดใจและพยายามยึดตามแผนเดิมให้ได้มากที่สุด", type: "J" }, { text: "รู้สึกตื่นเต้นและพร้อมปรับเปลี่ยนแผนไปตามสถานการณ์", type: "P" }] },
        { question: "เมื่ออ่านหนังสือเพื่อความเพลิดเพลิน คุณชอบ...", answers: [{ text: "เรื่องราวที่อิงตามความเป็นจริง", type: "S" }, { text: "เรื่องราวที่ผู้เขียนใช้จินตนาการอย่างเต็มที่", type: "N" }] },
        { question: "คุณจะรู้สึกภูมิใจมากกว่าหากมีคนบอกว่าคุณเป็น...", answers: [{ text: "คนที่เห็นอกเห็นใจและใส่ใจความรู้สึกผู้อื่น", type: "F" }, { text: "คนที่ตัดสินใจได้อย่างมีเหตุผลและเที่ยงตรงเสมอ", type: "T" }] },
        { question: "ในเรื่องเพื่อนฝูง คุณมีแนวโน้มที่จะมี...", answers: [{ text: "เพื่อนสนิทเพียงไม่กี่คน", type: "I" }, { text: "เพื่อนหลายกลุ่มและคนรู้จักมากมาย", type: "E" }] },
        { question: "ในการตัดสินใจเรื่องสำคัญ ส่วนใหญ่คุณใช้...", answers: [{ text: "ความรู้สึกและสัญชาตญาณนำเหตุผล", type: "F" }, { text: "เหตุผลและหลักการนำความรู้สึก", type: "T" }] },
        { question: "คุณสามารถพูดคุยได้อย่างเป็นธรรมชาติกับ...", answers: [{ text: "คนที่นิสัยคล้ายคลึงกับคุณ", type: "I" }, { text: "คนแทบทุกประเภท", type: "E" }] },
        { question: "การต้องทำตามแผนงานที่กำหนดไว้ ทำให้คุณ...", answers: [{ text: "รู้สึกสบายใจและมีทิศทางที่ชัดเจน", type: "J" }, { text: "รู้สึกอึดอัดและขาดความยืดหยุ่น", type: "P" }] },
        { question: "เมื่อได้รับมอบหมายงานใหญ่ที่มีเวลาหนึ่งสัปดาห์ คุณจะ...", answers: [{ text: "แบ่งงานออกเป็นส่วนย่อยๆ และวางแผนการทำงานอย่างชัดเจน", type: "J" }, { text: "เริ่มลงมือทำไปก่อน แล้วค่อยปรับแก้ตามสถานการณ์", type: "P" }] },
        { question: "ในการพูดคุยกับเพื่อน คุณ...", answers: [{ text: "มั่นใจที่จะเล่าเรื่องส่วนตัวให้ฟัง", type: "E" }, { text: "แทบจะไม่เล่าเรื่องที่คุณรู้สึกไม่ดี", type: "I" }] },
        { question: "หากเป็นครู คุณอยากสอนวิชาที่เกี่ยวกับ...", answers: [{ text: "ข้อเท็จจริงและหลักการพื้นฐาน", type: "S" }, { text: "ทฤษฎีและแนวคิด", type: "N" }] },
        { question: "ในการรับฟังความคิดเห็นเกี่ยวกับผลงานของคุณ คุณให้ความสำคัญกับ...", answers: [{ text: "คำชื่นชมและกำลังใจ", type: "F" }, { text: "คำวิจารณ์ที่ตรงไปตรงมาเพื่อการพัฒนา", type: "T" }] },
        { question: "โดยปกติ คุณเป็นคน...", answers: [{ text: "แสดงความรู้สึกอย่างเปิดเผย", type: "E" }, { text: "เก็บความรู้สึกไว้กับตัวเอง", type: "I" }] },
        { question: "เมื่อทำงานเสร็จตามแผน คุณจะ...", answers: [{ text: "รู้สึกดีที่ทุกอย่างเป็นไปตามแผน", type: "J" }, { text: "รู้สึกว่าถูกจำกัดและไม่เป็นอิสระ", type: "P" }] },
        { question: "คุณเข้ากับคนประเภทไหนได้ดีกว่ากัน", answers: [{ text: "คนที่เต็มไปด้วยจินตนาการและมองภาพใหญ่", type: "N" }, { text: "คนที่อยู่กับความเป็นจริงและใส่ใจในรายละเอียด", type: "S" }] },
        { question: "คุณจะรู้สึกแย่กับตัวเองมากกว่าหากถูกมองว่าเป็นคน...", answers: [{ text: "ไม่ใส่ใจความรู้สึกของผู้อื่น", type: "F" }, { text: "ใช้อารมณ์มากกว่าเหตุผล", type: "T" }] },
        { question: "เมื่อถูกคนแปลกหน้าวิจารณ์ คุณจะ...", answers: [{ text: "รู้สึกอึดอัด ไม่สบายใจ", type: "E" }, { text: "ไม่รู้สึกอะไรเป็นพิเศษ", type: "I" }] },
        { question: "ข้อโต้แย้งใดที่คุณให้น้ำหนักมากกว่า", answers: [{ text: "การกระทำนั้นเป็นที่ยอมรับของคนส่วนใหญ่", type: "F" }, { text: "การกระทำนั้นสมเหตุสมผลที่สุดสำหรับคุณ", type: "T" }] },
        { question: "การเก็บความลับของคุณเป็นแบบไหน", answers: [{ text: "แทบไม่บอกใครเลย หรือบอกแค่คนที่ไว้ใจที่สุด", type: "I" }, { text: "อาจจะเล่าให้เพื่อนสนิทหลายๆ คนฟัง", type: "E" }] },
        { question: "คุณชอบที่จะ...", answers: [{ text: "วางแผนการนัดหมายและกิจกรรมต่างๆ ล่วงหน้า", type: "J" }, { text: "ตัดสินใจทำอะไรแบบฉับพลันตามความรู้สึก", type: "P" }] },
        { question: "นิสัยของคุณคือ...", answers: [{ text: "ชอบทำงานในนาทีสุดท้าย", type: "P" }, { text: "รู้สึกเครียดหากต้องทำงานในนาทีสุดท้าย", type: "J" }] },
        { question: "คนที่คุณแอบชอบ จะรู้ตัวหรือไม่", answers: [{ text: "ส่วนใหญ่จะรู้ เพราะคุณแสดงออกชัดเจน", type: "E" }, { text: "อาจจะไม่รู้เลย ถ้าคุณไม่ได้เป็นคนบอกเอง", type: "I" }] },
        { question: "เมื่อต้องทำตามธรรมเนียมปฏิบัติ คุณชอบที่จะ...", answers: [{ text: "ทำตามแบบแผนที่ได้รับการยอมรับ", type: "S" }, { text: "คิดค้นวิธีการใหม่ๆ ในแบบของตัวเอง", type: "N" }] },
        { question: "คุณคิดว่าสังคมเรายังขาดคนประเภทใด", answers: [{ text: "คนที่เห็นอกเห็นใจผู้อื่นมากๆ", type: "F" }, { text: "คนที่ยึดมั่นในหลักการอย่างแน่วแน่", type: "T" }] },
        { question: "เมื่ออยู่ท่ามกลางคนจำนวนมาก คุณมักจะ...", answers: [{ text: "มีส่วนร่วมในวงสนทนาใหญ่", type: "E" }, { text: "แยกตัวไปคุยกับคนใดคนหนึ่ง", type: "I" }] },
        { question: "การทำงานที่เป็นกิจวัตรซ้ำๆ ทุกวัน ทำให้คุณ...", answers: [{ text: "รู้สึกสบายใจและมั่นคง", type: "J" }, { text: "รู้สึกเบื่อหน่าย แม้จะจำเป็นต้องทำ", type: "P" }] },
        { question: "คุณชอบใช้ชีวิตแบบ...", answers: [{ text: "เป็นตัวของตัวเอง มีโลกส่วนตัว", type: "I" }, { text: "เข้าสังคม พบปะผู้คน", type: "E" }] },
        { question: "คุณจะรู้สึกแย่กับตัวเองมากกว่า เมื่อแสดงความเป็นกันเอง...", answers: [{ text: "มากเกินไป", type: "I" }, { text: "น้อยเกินไป", type: "E" }] },
        { question: "ในกลุ่มเพื่อน คุณมักจะเป็น...", answers: [{ text: "คนสุดท้ายที่รู้เรื่องราวต่างๆ", type: "I" }, { text: "คนที่รู้ข่าวคราวของทุกคน", type: "E" }] },
        { question: "คุณให้คุณค่ากับสิ่งใดมากกว่า", answers: [{ text: "คุณค่าทางจิตใจ", type: "F" }, { text: "หลักการและเหตุผล", type: "T" }] },
        { question: "ในงานเลี้ยงสังสรรค์ คุณมักจะ...", answers: [{ text: "เลือกคุยกับคนที่สนใจเพียงไม่กี่คน", type: "I" }, { text: "พยายามพูดคุยทักทายกับคนทั้งกลุ่ม", type: "E" }] },
        { question: "เมื่อมีงานพิเศษที่ต้องทำ คุณจะ...", answers: [{ text: "วางแผนอย่างรอบคอบก่อนเริ่ม", type: "J" }, { text: "เรียนรู้และแก้ปัญหาไปในระหว่างที่ทำ", type: "P" }] },
        { question: "คุณทำงานได้ดีกว่าเมื่องาน...", answers: [{ text: "เป็นงานประจำที่คุ้นเคย", type: "J" }, { text: "มีความหลากหลายและท้าทาย", type: "P" }] },
        { question: "ในงานเลี้ยง คุณ...", answers: [{ text: "บางครั้งรู้สึกว่าน่าเบื่อ", type: "I" }, { text: "รู้สึกสนุกสนานอยู่เสมอ", type: "E" }] },
        { question: "เมื่อทำงานบ้านเสร็จเรียบร้อยแล้ว คุณจะ...", answers: [{ text: "มองหางานอื่นทำต่อทันที", type: "J" }, { text: "พักผ่อนสบายๆ จนกว่าจะอยากทำอะไรอีกครั้ง", type: "P" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ข้อเท็จจริง", type: "S" }, { text: "แนวคิด", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "การโน้มน้าวด้วยเหตุผล", type: "T" }, { text: "การเข้าถึงด้วยอารมณ์", type: "F" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "พูด", type: "E" }, { text: "เขียน", type: "I" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ตรงต่อเวลา", type: "J" }, { text: "ยืดหยุ่น", type: "P" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ก่อสร้าง", type: "S" }, { text: "คิดค้น", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "เห็นด้วย", type: "T" }, { text: "ตั้งคำถาม", type: "F" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "รูปธรรม / สิ่งที่จับต้องได้", type: "S" }, { text: "นามธรรม / แนวคิด", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ผลประโยชน์", type: "T" }, { text: "พรสวรรค์", type: "F" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "สงบ", type: "I" }, { text: "ร่าเริง", type: "E" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "เป็นระเบียบ", type: "J" }, { text: "สบายๆ", type: "P" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ตามตัวอักษร", type: "S" }, { text: "โดยนัย", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "วิเคราะห์", type: "T" }, { text: "เห็นอกเห็นใจ", type: "F" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "การผลิต", type: "S" }, { text: "การออกแบบ", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "อ่อนโยน", type: "F" }, { text: "แข็งแกร่ง", type: "T" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "เก็บตัว", type: "I" }, { text: "ช่างพูด", type: "E" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "เป็นระบบ", type: "J" }, { text: "ไม่เป็นทางการ", type: "P" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "เครื่องหมาย", type: "S" }, { text: "สัญลักษณ์", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "หนักแน่น", type: "T" }, { text: "อบอุ่น", type: "F" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ยอมรับ", type: "S" }, { text: "เปลี่ยนแปลง", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ใคร", type: "S" }, { text: "อะไร", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "มีกำหนดการ", type: "J" }, { text: "ไม่มีแผน", type: "P" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "สิ่งที่รู้จัก", type: "S" }, { text: "สิ่งที่ไม่รู้จัก", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ระมัดระวัง", type: "I" }, { text: "ไว้ใจ", type: "E" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ข้อเท็จจริง", type: "S" }, { text: "ไอเดีย", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "สุภาพ", type: "F" }, { text: "มั่นคง", type: "T" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "รากฐาน", type: "S" }, { text: "ยอด", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ความยุติธรรม", type: "T" }, { text: "ความเมตตา", type: "F" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ประสบการณ์", type: "S" }, { text: "ทฤษฎี", type: "N" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ไม่ตัดสิน", type: "F" }, { text: "วิเคราะห์วิจารณ์", type: "T" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ความคิด", type: "T" }, { text: "ความรู้สึก", type: "F" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ลื่นไหล", type: "P" }, { text: "มั่นคง (Solid)", type: "J" }] },
        { question: "เลือกคำที่ตรงกับคุณ:", answers: [{ text: "ความเห็นใจ", type: "F" }, { text: "การมองการณ์ไกล", type: "T" }] },
        { question: "คำชมแบบไหนที่คุณคิดว่ามีคุณค่ามากกว่า", answers: [{ text: "คนที่มีวิสัยทัศน์", type: "N" }, { text: "คนที่มีสามัญสำนึก", type: "S" }] },
        { question: "คุณระมัดระวังเรื่องใดเป็นพิเศษ", answers: [{ text: "ความรู้สึกของคนอื่น", type: "F" }, { text: "สิทธิของแต่ละคน", type: "T" }] },
        { question: "ในงานเลี้ยง คุณชอบที่จะ...", answers: [{ text: "ช่วยดูแลให้งานดำเนินไปอย่างเรียบร้อย", type: "E" }, { text: "ปล่อยให้ทุกคนสนุกในแบบของตัวเอง", type: "I" }] },
        { question: "คุณชอบ...", answers: [{ text: "วางแผนกิจกรรมต่างๆ ไว้ล่วงหน้าอย่างชัดเจน", type: "J" }, { text: "ตัดสินใจทำอะไรแบบปัจจุบันทันด่วนมากกว่า", type: "P" }] },
        { question: "ในกลุ่มเพื่อนสนิท คุณมักจะ...", answers: [{ text: "เป็นฝ่ายพูดมากกว่าฟัง", type: "E" }, { text: "เป็นฝ่ายฟังมากกว่าพูด", type: "I" }] },
        { question: "โดยธรรมชาติแล้ว คุณสนใจเรื่องใดมากกว่า", answers: [{ text: "เรื่องราวเกี่ยวกับผู้คนและความสัมพันธ์", type: "F" }, { text: "สิ่งของและกลไกการทำงานของมัน", type: "T" }] },
        { question: "ในกลุ่มคน คุณมักจะ...", answers: [{ text: "เป็นคนแนะนำให้คนอื่นรู้จักกัน", type: "E" }, { text: "เป็นคนที่ถูกแนะนำให้รู้จักคนอื่น", type: "I" }] },
        { question: "เมื่อต้องเดินทาง คุณชอบที่จะ...", answers: [{ text: "วางแผนล่วงหน้าว่าจะทำอะไร ที่ไหน เมื่อไหร่", type: "J" }, { text: "ไปโดยไม่มีแผนและตัดสินใจหน้างาน", type: "P" }] },
        { question: "คุณชอบคิดทบทวนเรื่องต่างๆ ด้วยการ...", answers: [{ text: "พูดคุยแลกเปลี่ยนกับคนอื่น", type: "E" }, { text: "ใช้เวลาคิดเงียบๆ คนเดียว", type: "I" }] },
        { question: "คนที่เพิ่งรู้จัก สามารถเดาความชอบของคุณได้ง่ายหรือไม่", answers: [{ text: "ง่ายมาก เพราะคุณแสดงออกชัดเจน", type: "E" }, { text: "ค่อนข้างยาก จนกว่าจะรู้จักกันดี", type: "I" }] },
        { question: "หากมีงานด่วนและน่าเบื่อเข้ามา คุณจะ...", answers: [{ text: "รีบทำให้เสร็จเป็นอย่างแรก", type: "J" }, { text: "สลับทำกับงานอื่นที่น่าสนใจกว่า", type: "P" }] },
        { question: "โดยปกติแล้ว เวลาคุณพูด คุณมักจะ...", answers: [{ text: "พูดทุกอย่างที่คิด", type: "E" }, { text: "คิดก่อนพูดเสมอ", type: "I" }] },
        { question: "สไตล์การทำงานของคุณคือ...", answers: [{ text: "รู้สึกดีที่ทำงานเสร็จเรียบร้อยก่อนกำหนดเวลา", type: "J" }, { text: "สนุกกับการทำงานภายใต้ความกดดันเพื่อให้เสร็จทันเวลาพอดี", type: "P" }] },
        { question: "เมื่อพบคนแปลกหน้า คุณรู้สึก...", answers: [{ text: "เป็นธรรมชาติและสบายๆ", type: "E" }, { text: "ต้องใช้ความพยายามในการเข้าหา", type: "I" }] },
        { question: "หากมีความคิดเห็นในที่ประชุม คุณจะ...", answers: [{ text: "เสนอความคิดเห็นทันที", type: "E" }, { text: "ลังเลและรอจังหวะที่เหมาะสม", type: "I" }] }
    ];
    const personalityTypes = { /* ... All personality types remain the same ... */ 
         "ISTJ": { title: "นักปฏิบัติ", desc: "เป็นคนจริงจัง มีความรับผิดชอบสูง น่าเชื่อถือและพึ่งพาได้ ชอบทำงานตามลำพังและใส่ใจในรายละเอียด ข้อเท็จจริง และตรรกะ", jobs: "มักจะโดดเด่นในงานที่ต้องการความแม่นยำ, การจัดการที่เป็นระบบ, และความน่าเชื่อถือสูง สภาพแวดล้อมที่มีโครงสร้างชัดเจนจะส่งเสริมศักยภาพได้ดี<br><b>ตำแหน่งงานที่แนะนำ:</b> นักบัญชี, นักวิเคราะห์ข้อมูล, ผู้ตรวจสอบบัญชี, ผู้จัดการซัพพลายเชน, โปรแกรมเมอร์" },
        "ISFJ": { title: "ผู้พิทักษ์", desc: "เป็นคนอบอุ่น ใจดี มีความรับผิดชอบและพร้อมช่วยเหลือผู้อื่นอยู่เสมอ ให้ความสำคัญกับความปรองดองและธรรมเนียมปฏิบัติ เป็นผู้ฟังที่ดีและน่าเชื่อถือ", jobs: "เหมาะกับงานที่ได้ดูแลช่วยเหลือผู้อื่นและสร้างสภาพแวดล้อมที่อบอุ่นเป็นระเบียบ มีความสุขในการทำงานที่ช่วยเหลือสังคมและผู้คน<br><b>ตำแหน่งงานที่แนะนำ:</b> พยาบาล, ครู, นักสังคมสงเคราะห์, ผู้จัดการฝ่ายบุคคล, ฝ่ายบริการลูกค้า" },
        "INFJ": { title: "ผู้แนะนำ", desc: "เป็นคนเงียบๆ แต่มีความมุ่งมั่นสูง มีความคิดสร้างสรรค์และอุดมการณ์ มองการณ์ไกลและเข้าใจความรู้สึกของผู้อื่นได้อย่างลึกซึ้ง", jobs: "ต้องการทำงานที่มีความหมายและสร้างผลกระทบเชิงบวกต่อสังคม ชอบงานที่ได้ใช้ความคิดสร้างสรรค์เพื่อช่วยเหลือผู้คน<br><b>ตำแหน่งงานที่แนะนำ:</b> นักจิตวิทยา, ที่ปรึกษา, นักเขียน, นักออกแบบ UX/UI, งานในองค์กรไม่แสวงหาผลกำไร" },
        "INTJ": { title: "นักออกแบบ", desc: "เป็นนักคิดเชิงกลยุทธ์ มีความคิดสร้างสรรค์และวิสัยทัศน์ที่ชัดเจน ชอบวางแผนและแก้ไขปัญหาที่ซับซ้อน มุ่งมั่นสู่ความเป็นเลิศในทุกสิ่งที่ทำ", jobs: "โดดเด่นในสภาพแวดล้อมที่ท้าทายและให้อิสระในการวางกลยุทธ์และพัฒนาระบบใหม่ๆ ชอบแก้ไขปัญหาที่ซับซ้อน<br><b>ตำแหน่งงานที่แนะนำ:</b> สถาปนิก, วิศวกร, นักวางแผนกลยุทธ์, นักวิทยาศาสตร์, ผู้พัฒนาซอฟต์แวร์" },
        "ISTP": { title: "ผู้เชี่ยวชาญ", desc: "เป็นคนรักอิสระ ชอบลงมือปฏิบัติและเรียนรู้ผ่านประสบการณ์ แก้ปัญหาเฉพาะหน้าได้ดีเยี่ยม มีเหตุผลและชอบสำรวจสิ่งใหม่ๆ", jobs: "เหมาะกับงานที่ได้ลงมือทำจริงและแก้ไขปัญหาเฉพาะหน้า มีความสามารถในการวิเคราะห์และจัดการกับเครื่องมือหรือระบบที่ซับซ้อน<br><b>ตำแหน่งงานที่แนะนำ:</b> วิศวกร, ช่างเทคนิค, นักบิน, ผู้เชี่ยวชาญด้าน IT, เจ้าหน้าที่กู้ภัย" },
        "ISFP": { title: "นักผจญภัย", desc: "เป็นคนรักศิลปะ มีเสน่ห์และเป็นมิตร ชอบใช้ชีวิตในปัจจุบันและเปิดรับประสบการณ์ใหม่ๆ มีความยืดหยุ่นและปรับตัวเก่ง", jobs: "ชอบสภาพแวดล้อมการทำงานที่ยืดหยุ่นและได้ใช้ความคิดสร้างสรรค์หรืองานฝีมือ ไม่ชอบการวางแผนที่ตายตัว<br><b>ตำแหน่งงานที่แนะนำ:</b> ศิลปิน, นักออกแบบกราฟิก, เชฟ, นักดนตรี, ช่างภาพ" },
        "INFP": { title: "ผู้ไกล่เกลี่ย", desc: "เป็นคนมีอุดมการณ์ อ่อนโยนและเห็นอกเห็นใจผู้อื่น ชอบช่วยเหลือและมองหาความดีงามในตัวคน มีความคิดสร้างสรรค์และขับเคลื่อนด้วยคุณค่าส่วนตัว", jobs: "ต้องการทำงานที่สอดคล้องกับคุณค่าของตนเองและได้ช่วยเหลือผู้อื่น ชอบงานที่ต้องใช้ความคิดสร้างสรรค์และการแสดงออกทางความรู้สึก<br><b>ตำแหน่งงานที่แนะนำ:</b> นักเขียน, นักบำบัด, ครู, บรรณารักษ์, นักออกแบบ" },
        "INTP": { title: "นักตรรกะ", desc: "เป็นนักคิดค้นและนักทฤษฎี มีความคิดสร้างสรรค์และกระหายความรู้ ชอบวิเคราะห์หารูปแบบและคำอธิบายสำหรับทุกสิ่ง", jobs: "มีความสุขกับการทำงานที่ได้วิเคราะห์ทฤษฎีและแก้ไขปัญหาที่ซับซ้อน ชอบทำงานคนเดียวและต้องการอิสระทางความคิด<br><b>ตำแหน่งงานที่แนะนำ:</b> นักวิทยาศาสตร์, นักวิจัย, ศาสตราจารย์, นักพัฒนาซอฟต์แวร์, นักวิเคราะห์ระบบ" },
        "ESTP": { title: "ผู้ประกอบการ", desc: "เป็นคนมีพลังงานสูง กล้าได้กล้าเสียและชาญฉลาด ชอบอยู่ท่ามกลางผู้คนและแก้ไขปัญหาเฉพาะหน้าได้อย่างรวดเร็ว เน้นการลงมือทำจริง", jobs: "เหมาะกับสภาพแวดล้อมที่รวดเร็วและท้าทาย ชอบการทำงานที่ได้เคลื่อนไหวและตัดสินใจอย่างรวดเร็ว มีความสามารถในการเจรจาต่อรอง<br><b>ตำแหน่งงานที่แนะนำ:</b> นักธุรกิจ, นักลงทุน, ตำรวจ, นักข่าวภาคสนาม, ฝ่ายขาย" },
        "ESFP": { title: "ผู้มอบความบันเทิง", desc: "เป็นคนสนุกสนาน มีชีวิตชีวาและเป็นธรรมชาติ ชอบเป็นจุดสนใจและสร้างความสุขให้คนรอบข้าง มีความเป็นมิตรและเข้ากับคนง่าย", jobs: "ชอบทำงานที่ได้พบปะผู้คนและสร้างบรรยากาศที่สนุกสนาน มีพลังงานล้นเหลือและชอบการทำงานเป็นทีม<br><b>ตำแหน่งงานที่แนะนำ:</b> นักแสดง, นักวางแผนงานอีเวนต์, ฝ่ายขาย, พนักงานต้อนรับ, ครูปฐมวัย" },
        "ENFP": { title: "นักรณรงค์", desc: "เป็นคนกระตือรือร้น มีความคิดสร้างสรรค์และเข้าสังคมเก่ง มองโลกในแง่ดีและสามารถสร้างแรงบันดาลใจให้ผู้อื่นได้ดีเยี่ยม", jobs: "เหมาะกับงานที่ได้ใช้ความคิดสร้างสรรค์, ได้พบปะผู้คนหลากหลาย และสร้างแรงบันดาลใจให้ผู้อื่น ไม่ชอบงานที่มีกฎเกณฑ์ตายตัวและซ้ำซาก<br><b>ตำแหน่งงานที่แนะนำ:</b> นักการตลาด, ฝ่ายบุคคล (HR), ที่ปรึกษา, นักเขียน, ผู้กำกับฝ่ายศิลป์, งานด้านประชาสัมพันธ์" },
        "ENTP": { title: "นักโต้วาที", desc: "เป็นคนฉลาด มีไหวพริบและช่างสงสัย ชอบท้าทายแนวคิดเดิมๆ และสำรวจไอเดียใหม่ๆ มีความสามารถในการโต้เถียงและมองเห็นความเป็นไปได้ที่หลากหลาย", jobs: "ชอบงานที่ท้าทายความคิดและได้ถกเถียงเพื่อหาทางออกที่ดีที่สุด เบื่อง่ายกับงานซ้ำซากและต้องการความแปลกใหม่อยู่เสมอ<br><b>ตำแหน่งงานที่แนะนำ:</b> ทนายความ, ที่ปรึกษาทางธุรกิจ, นักประดิษฐ์, ผู้ประกอบการ, นักการเมือง" },
        "ESTJ": { title: "ผู้บริหาร", desc: "เป็นผู้จัดการที่ยอดเยี่ยม มีระเบียบแบบแผนและเด็ดขาด ชอบบริหารจัดการสิ่งต่างๆ ให้เป็นไปตามขั้นตอนและมีประสิทธิภาพสูง", jobs: "มีความสามารถในการบริหารจัดการและดูแลให้ทุกอย่างเป็นไปตามกฎระเบียบ ชอบสภาพแวดล้อมที่มีโครงสร้างชัดเจนและวัดผลได้<br><b>ตำแหน่งงานที่แนะนำ:</b> ผู้จัดการ, ผู้บริหาร, ผู้พิพากษา, เจ้าหน้าที่สินเชื่อ, ผู้อำนวยการโรงเรียน" },
        "ESFJ": { title: "ผู้ให้คำปรึกษา", desc: "เป็นคนชอบเข้าสังคม เป็นที่รักและพร้อมช่วยเหลือผู้อื่นอยู่เสมอ มีความรับผิดชอบและให้ความสำคัญกับความเป็นอยู่ที่ดีของคนในกลุ่ม", jobs: "มีความสุขกับการทำงานที่ได้ช่วยเหลือและประสานงานกับผู้คน ชอบสร้างความสามัคคีและทำงานร่วมกับผู้อื่นเป็นทีม<br><b>ตำแหน่งงานที่แนะนำ:</b> ฝ่ายบุคคล (HR), ผู้จัดการ, ครู, นักวางแผนงานอีเวนต์, พยาบาล" },
        "ENFJ": { title: "ตัวเอก", desc: "เป็นผู้นำที่มีเสน่ห์และสร้างแรงบันดาลใจ เข้าใจและใส่ใจความรู้สึกของผู้อื่น มีความสามารถในการโน้มน้าวและกระตุ้นให้ผู้คนทำตามเป้าหมาย", jobs: "โดดเด่นในบทบาทผู้นำที่ต้องชี้นำและพัฒนาศักยภาพของทีม ชอบทำงานที่ได้สร้างความสัมพันธ์และช่วยเหลือให้ผู้อื่นเติบโต<br><b>ตำแหน่งงานที่แนะนำ:</b> ครู, ผู้จัดการฝ่ายประชาสัมพันธ์, โค้ช, นักการทูต, ผู้จัดการฝ่ายขาย" },
        "ENTJ": { title: "ผู้บัญชาการ", desc: "เป็นผู้นำที่มีความมั่นใจและเด็ดขาด มีวิสัยทัศน์กว้างไกลและชอบความท้าทาย สามารถวางแผนกลยุทธ์และผลักดันทีมไปสู่ความสำเร็จได้", jobs: "เหมาะกับตำแหน่งผู้นำที่ต้องตัดสินใจเด็ดขาดและวางแผนระยะยาว ชอบความท้าทายและต้องการเห็นผลลัพธ์ที่เป็นรูปธรรม<br><b>ตำแหน่งงานที่แนะนำ:</b> ผู้บริหารระดับสูง (CEO), ผู้ประกอบการ, ที่ปรึกษาทางธุรกิจ, ผู้จัดการโครงการ" }
    };
    
    // --- APPLICATION LOGIC ---
    (function() {
        // IMPORTANT: Replace with your own EmailJS User ID (Public Key)
        emailjs.init({ publicKey: "RB1kmyw8Syp8yi1P4" });
    })();

    const ui = {
        startScreen: document.getElementById('start-screen'),
        quizSection: document.getElementById('quiz-section'),
        resultContainer: document.getElementById('result-container'),
        questionText: document.getElementById('question-text'),
        answerButtons: document.getElementById('answer-buttons'),
        progressBar: document.getElementById('progress-bar'),
        applicantIdentifierInput: document.getElementById('applicant-identifier'),
        resultSummary: document.getElementById('result-summary'),
        resultDetails: document.getElementById('result-details'),
        chartContainer: document.getElementById('chart-container'),
        loadingResults: document.getElementById('loading-results'),
        resultsContent: document.getElementById('results-content'),
        emailForm: document.getElementById('email-form'),
        sendingStatus: document.getElementById('sending-status'),
    };

    let userAnswers = [];
    let emailHtmlBody = ''; // To store the generated HTML for the email

    function startQuiz() {
        if (ui.applicantIdentifierInput.value.trim() === '') {
            alert('กรุณากรอกชื่อ-สกุล หรืออีเมล');
            return;
        }
        ui.startScreen.style.display = 'none';
        ui.quizSection.style.display = 'block';
        userAnswers = [];
        showQuestion(0);
    }
    window.startQuiz = startQuiz; // Make it accessible from HTML onclick

    function showQuestion(index) {
        ui.answerButtons.innerHTML = '';
        const q = questions[index];
        ui.questionText.innerText = `(${index + 1}/${questions.length}) ${q.question}`;
        q.answers.forEach(answer => {
            const button = document.createElement('button');
            button.innerText = answer.text;
            button.className = 'btn';
            button.onclick = () => selectAnswer(answer.type, index);
            ui.answerButtons.appendChild(button);
        });
        ui.progressBar.style.width = `${(index / questions.length) * 100}%`;
    }
    
    function selectAnswer(type, currentIndex) {
        userAnswers.push(type);
        const nextIndex = currentIndex + 1;
        if (nextIndex < questions.length) {
            showQuestion(nextIndex);
        } else {
            ui.progressBar.style.width = '100%';
            showResult();
        }
    }

    function calculateResult() {
        const scores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        userAnswers.forEach(answer => { scores[answer]++; });
        let type = '';
        type += scores.E >= scores.I ? 'E' : 'I';
        type += scores.S >= scores.N ? 'S' : 'N';
        type += scores.T >= scores.F ? 'T' : 'F';
        type += scores.J >= scores.P ? 'J' : 'P';
        return { type, scores };
    }

    async function showResult() {
        ui.quizSection.style.display = 'none';
        ui.resultContainer.style.display = 'block';

        const { type, scores } = calculateResult();
        const typeInfo = personalityTypes[type];

        const chartImages = await renderResultCharts(scores);
        emailHtmlBody = prepareHtmlEmailBody(type, scores, typeInfo, chartImages);
        
        ui.resultSummary.innerHTML = `<h3 class="fw-bold mb-0">${type} - ${typeInfo.title}</h3>`;
        ui.resultDetails.innerHTML = `<p>${typeInfo.desc}</p>
                                    <h5 class="mt-4">ลักษณะงานที่เหมาะสม:</h5>
                                    <p>${typeInfo.jobs}</p>`;
        
        ui.loadingResults.style.display = 'none';
        ui.resultsContent.style.display = 'block';
    }

    function renderResultCharts(scores) {
        ui.chartContainer.innerHTML = '';
        const dimensions = [
            { pair: ['E', 'I'], labels: ['E: เข้าสังคม', 'I: เก็บตัว'], colors: ['#36A2EB', '#FF6384'] },
            { pair: ['S', 'N'], labels: ['S: ใช้ความจริง', 'N: ใช้สัญชาตญาณ'], colors: ['#4BC0C0', '#FFCD56'] },
            { pair: ['T', 'F'], labels: ['T: ใช้ความคิด', 'F: ใช้ความรู้สึก'], colors: ['#9966FF', '#FF9F40'] },
            { pair: ['J', 'P'], labels: ['J: มีการวางแผน', 'P: มีความยืดหยุ่น'], colors: ['#28A745', '#6C757D'] }
        ];

        const chartPromises = dimensions.map((dim, index) => {
            return new Promise(resolve => {
                const score1 = scores[dim.pair[0]];
                const score2 = scores[dim.pair[1]];
                
                const canvas = document.createElement('canvas');
                canvas.id = `chart-${index}`;
                canvas.style.marginBottom = '1rem';
                ui.chartContainer.appendChild(canvas);

                new Chart(canvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [dim.labels[0], dim.labels[1]],
                        datasets: [{ data: [score1, score2], backgroundColor: [dim.colors[0], dim.colors[1]], borderWidth: 0 }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { x: { beginAtZero: true, suggestedMax: Math.max(score1, score2) + 5 }, y: { grid: { display: false } } },
                        animation: { onComplete: (animation) => { resolve(animation.chart.toBase64Image()); } }
                    }
                });
            });
        });
        return Promise.all(chartPromises);
    }

    function validateEmail(email) {
        const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }

    async function sendEmail(event) {
        event.preventDefault();
        const emailInput = document.getElementById('sender-email');
        const errorDiv = document.getElementById('email-error');
        const submitButton = ui.emailForm.querySelector('button[type="submit"]');

        const senderEmail = emailInput.value;
        if (!validateEmail(senderEmail)) {
            errorDiv.textContent = 'กรุณากรอกรูปแบบอีเมลให้ถูกต้อง';
            return;
        }
        errorDiv.textContent = '';
        submitButton.disabled = true;
        ui.sendingStatus.innerHTML = '<div class="alert alert-info">กำลังส่งผลการทดสอบ...</div>';

        const templateParams = {
            applicant_identifier: ui.applicantIdentifierInput.value,
            applicant_email: senderEmail,
            to_email: hrEmail,
            html_body: emailHtmlBody,
        };

        try {
            // IMPORTANT: Replace with your Service ID and Template ID
            await emailjs.send('service_egazmzk', 'template_q8pllkd', templateParams);
            ui.sendingStatus.innerHTML = '<div class="alert alert-success">ส่งผลการทดสอบสำเร็จแล้ว! ขอบคุณครับ/ค่ะ</div>';
            ui.emailForm.style.display = 'none';
        } catch (error) {
            ui.sendingStatus.innerHTML = `<div class="alert alert-danger">เกิดข้อผิดพลาดในการส่ง: ${error.text || 'กรุณาตรวจสอบการตั้งค่า EmailJS'}. กรุณาถ่ายภาพหน้าจอหน้านี้แล้วส่งผลทาง LINE แทน</div>`;
            submitButton.disabled = false;
        }
    }

    ui.emailForm.addEventListener('submit', sendEmail);

    function prepareHtmlEmailBody(type, scores, typeInfo, chartImages) {
        const applicant = ui.applicantIdentifierInput.value;
        const scoreHtml = `
            <p style="margin: 4px 0;"><b>E (เข้าสังคม):</b> ${scores.E} vs <b>I (เก็บตัว):</b> ${scores.I}</p>
            <p style="margin: 4px 0;"><b>S (จากความจริง):</b> ${scores.S} vs <b>N (จากสัญชาตญาณ):</b> ${scores.N}</p>
            <p style="margin: 4px 0;"><b>T (ใช้ความคิด):</b> ${scores.T} vs <b>F (ใช้ความรู้สึก):</b> ${scores.F}</p>
            <p style="margin: 4px 0;"><b>J (วางแผน):</b> ${scores.J} vs <b>P (ยืดหยุ่น):</b> ${scores.P}</p>
        `;
        const chartHtml = chartImages.map((img) => `
            <p style="text-align:center; margin-top: 20px; margin-bottom: 10px;">
                <img src="${img}" alt="Chart" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px;">
            </p>
        `).join('');

        return `
            <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
                <div style="max-width: 680px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
                    <h2 style="color: #00827f; border-bottom: 2px solid #eee; padding-bottom: 10px;">ผลการทดสอบบุคลิกภาพ</h2>
                    <p><strong>ผู้สมัคร:</strong> ${applicant}</p>
                    <p><strong>ประเภทบุคลิกภาพ:</strong> <span style="font-size: 1.2em; font-weight: bold;">${type} - ${typeInfo.title}</span></p>
                    <hr style="border: none; border-top: 1px solid #eee;">
                    <h3 style="color: #00827f;">สรุปคะแนน</h3>
                    ${scoreHtml}
                    <h3 style="color: #00827f; margin-top: 30px;">กราฟแสดงผล</h3>
                    ${chartHtml}
                    <hr style="border: none; border-top: 1px solid #eee; margin-top: 30px;">
                    <h3 style="color: #00827f;">คำอธิบายบุคลิกภาพ</h3>
                    <p>${typeInfo.desc}</p>
                    <h3 style="color: #00827f;">ลักษณะงานที่เหมาะสม</h3>
                    <p>${typeInfo.jobs.replace(/<br>/g, ' ')}</p>
                    <hr style="border: none; border-top: 1px solid #eee;">
                    <p style="font-size: 0.8em; color: #888; text-align: center;">รายงานนี้สร้างขึ้นโดยอัตโนมัติจากระบบแบบทดสอบของ Colossal International Co., Ltd.</p>
                </div>
            </body>`;
    }
</script>
</body>
</html>

